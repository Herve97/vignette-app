(function(){if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};fNOP.prototype=this.prototype;fBound.prototype=new fNOP;return fBound}}if(!window.getComputedStyle){window.getComputedStyle=function(el){return el.currentStyle}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){"use strict";if(this==null){throw new TypeError}var n,k,t=Object(this),len=t.length>>>0;if(len===0){return-1}n=0;if(arguments.length>1){n=Number(arguments[1]);if(n!=n){n=0}else if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n))}}if(n>=len){return-1}for(k=n>=0?n:Math.max(len-Math.abs(n),0);k<len;k++){if(k in t&&t[k]===searchElement){return k}}return-1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(callback,thisArg){var T,k;if(this==null){throw new TypeError(" this is null or not defined")}var O=Object(this);var len=O.length>>>0;if(typeof callback!=="function"){throw new TypeError(callback+" is not a function")}if(arguments.length>1){T=thisArg}k=0;while(k<len){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O)}k++}}}if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this==null){throw new TypeError(" this is null or not defined")}var O=Object(this);var len=O.length>>>0;if(typeof callback!=="function"){throw new TypeError(callback+" is not a function")}if(arguments.length>1){T=thisArg}A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue}k++}return A}}if(typeof window.HTMLElement==="undefined"&&window.Element){window.HTMLElement=window.Element}})();(function(){if(typeof document!=="undefined"&&!("classList"in document.documentElement)){(function(view){"use strict";if(!("HTMLElement"in view)&&!("Element"in view))return;var classListProp="classList",protoProp="prototype",elemCtrProto=(view.HTMLElement||view.Element)[protoProp],objCtr=Object,strTrim=String[protoProp].trim||function(){return this.replace(/^\s+|\s+$/g,"")},arrIndexOf=Array[protoProp].indexOf||function(item){var i=0,len=this.length;for(;i<len;i++){if(i in this&&this[i]===item){return i}}return-1},DOMEx=function(type,message){this.name=type;this.code=DOMException[type];this.message=message},checkTokenAndGetIndex=function(classList,token){if(token===""){throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(token)){throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character")}return arrIndexOf.call(classList,token)},ClassList=function(elem){var trimmedClasses=strTrim.call(elem.className),classes=trimmedClasses?trimmedClasses.split(/\s+/):[],i=0,len=classes.length;for(;i<len;i++){this.push(classes[i])}this._updateClassName=function(){elem.className=this.toString()}},classListProto=ClassList[protoProp]=[],classListGetter=function(){return new ClassList(this)};DOMEx[protoProp]=Error[protoProp];classListProto.item=function(i){return this[i]||null};classListProto.contains=function(token){token+="";return checkTokenAndGetIndex(this,token)!==-1};classListProto.add=function(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+"";if(checkTokenAndGetIndex(this,token)===-1){this.push(token);updated=true}}while(++i<l);if(updated){this._updateClassName()}};classListProto.remove=function(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+"";var index=checkTokenAndGetIndex(this,token);if(index!==-1){this.splice(index,1);updated=true}}while(++i<l);if(updated){this._updateClassName()}};classListProto.toggle=function(token,forse){token+="";var result=this.contains(token),method=result?forse!==true&&"remove":forse!==false&&"add";if(method){this[method](token)}return!result};classListProto.toString=function(){return this.join(" ")};if(objCtr.defineProperty){var classListPropDesc={get:classListGetter,enumerable:true,configurable:true};try{objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc)}catch(ex){if(ex.number===-2146823252){classListPropDesc.enumerable=false;objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc)}}}else if(objCtr[protoProp].__defineGetter__){elemCtrProto.__defineGetter__(classListProp,classListGetter)}})(self)}})();
/* !
 * @author Sean Coker <hello@sean.is>
 * @version 1.15.0
 * @url http://sean.is/poppin/tags
 * @license MIT
 * @description Taggle is a dependency-less tagging library
 */
(function(root,factory){"use strict";var libName="Taggle";if(typeof define==="function"&&define.amd){define([],function(){var module=factory();root[libName]=module;return module})}else if(typeof module==="object"&&module.exports){module.exports=root[libName]=factory()}else{root[libName]=factory()}})(this,function(){"use strict";var noop=function(){};var retTrue=function(){return true};var BACKSPACE=8;var DELETE=46;var COMMA=188;var TAB=9;var ENTER=13;var ARROW_LEFT=37;var ARROW_RIGHT=39;var DEFAULTS={additionalTagClasses:"",allowDuplicates:false,saveOnBlur:false,clearOnBlur:true,duplicateTagClass:"",containerFocusClass:"active",focusInputOnContainerClick:true,hiddenInputName:"taggles[]",tags:[],delimeter:",",delimiter:"",attachTagId:false,allowedTags:[],disallowedTags:[],trimTags:true,maxTags:null,tabIndex:1,placeholder:"Enter tags...",submitKeys:[COMMA,TAB,ENTER],preserveCase:false,inputFormatter:noop,tagFormatter:noop,onBeforeTagAdd:noop,onTagAdd:noop,onBeforeTagRemove:retTrue,onTagRemove:noop};function _extend(){var master=arguments[0];for(var i=1,l=arguments.length;i<l;i++){var object=arguments[i];for(var key in object){if(object.hasOwnProperty(key)){master[key]=object[key]}}}return master}function _isArray(arr){if(Array.isArray){return Array.isArray(arr)}return Object.prototype.toString.call(arr)==="[object Array]"}function _on(element,eventName,handler){if(element.addEventListener){element.addEventListener(eventName,handler,false)}else if(element.attachEvent){element.attachEvent("on"+eventName,handler)}else{element["on"+eventName]=handler}}function _off(element,eventName,handler){if(element.removeEventListener){element.removeEventListener(eventName,handler,false)}else if(element.detachEvent){element.detachEvent("on"+eventName,handler)}else{element["on"+eventName]=null}}function _trim(str){return str.replace(/^\s+|\s+$/g,"")}function _setText(el,text){if(window.attachEvent&&!window.addEventListener){el.innerText=text}else{el.textContent=text}}function _clamp(val,min,max){return Math.min(Math.max(val,min),max)}var Taggle=function(el,options){this.settings=_extend({},DEFAULTS,options);this.measurements={container:{rect:null,style:null,padding:null}};this.container=el;this.tag={values:[],elements:[]};this.list=document.createElement("ul");this.inputLi=document.createElement("li");this.input=document.createElement("input");this.sizer=document.createElement("div");this.pasting=false;this.placeholder=null;this.data=null;if(this.settings.placeholder){this.placeholder=document.createElement("span")}if(typeof el==="string"){this.container=document.getElementById(el)}this._id=0;this._backspacePressed=false;this._inputPosition=0;this._closeEvents=[];this._closeButtons=[];this._setMeasurements();this._setupTextarea();this._attachEvents()};Taggle.prototype._setMeasurements=function(){this.measurements.container.rect=this.container.getBoundingClientRect();this.measurements.container.style=window.getComputedStyle(this.container);var style=this.measurements.container.style;var lpad=parseInt(style["padding-left"]||style.paddingLeft,10);var rpad=parseInt(style["padding-right"]||style.paddingRight,10);var lborder=parseInt(style["border-left-width"]||style.borderLeftWidth,10);var rborder=parseInt(style["border-right-width"]||style.borderRightWidth,10);this.measurements.container.padding=lpad+rpad+lborder+rborder};Taggle.prototype._setupTextarea=function(){var fontSize;this.list.className="taggle_list";this.input.type="text";this.input.style.paddingLeft=0;this.input.style.paddingRight=0;this.input.className="taggle_input";this.input.tabIndex=this.settings.tabIndex;this.sizer.className="taggle_sizer";if(this.settings.tags.length){for(var i=0,len=this.settings.tags.length;i<len;i++){var taggle=this._createTag(this.settings.tags[i],this.tag.values.length);this.list.appendChild(taggle)}}if(this.placeholder){this._hidePlaceholder();this.placeholder.classList.add("taggle_placeholder");this.container.appendChild(this.placeholder);_setText(this.placeholder,this.settings.placeholder);if(!this.settings.tags.length){this._showPlaceholder()}}var formattedInput=this.settings.inputFormatter(this.input);if(formattedInput){this.input=formattedInput}this.inputLi.appendChild(this.input);this.list.appendChild(this.inputLi);this.container.appendChild(this.list);this.container.appendChild(this.sizer);fontSize=window.getComputedStyle(this.input).fontSize;this.sizer.style.fontSize=fontSize};Taggle.prototype._attachEvents=function(){var self=this;if(this._eventsAttached){return false}this._eventsAttached=true;function containerClick(){self.input.focus()}if(this.settings.focusInputOnContainerClick){this._handleContainerClick=containerClick.bind(this);_on(this.container,"click",this._handleContainerClick)}this._handleFocus=this._setFocusStateForContainer.bind(this);this._handleBlur=this._blurEvent.bind(this);this._handleKeydown=this._keydownEvents.bind(this);this._handleKeyup=this._keyupEvents.bind(this);_on(this.input,"focus",this._handleFocus);_on(this.input,"blur",this._handleBlur);_on(this.input,"keydown",this._handleKeydown);_on(this.input,"keyup",this._handleKeyup);return true};Taggle.prototype._detachEvents=function(){if(!this._eventsAttached){return false}var self=this;this._eventsAttached=false;_off(this.container,"click",this._handleContainerClick);_off(this.input,"focus",this._handleFocus);_off(this.input,"blur",this._handleBlur);_off(this.input,"keydown",this._handleKeydown);_off(this.input,"keyup",this._handleKeyup);this._closeButtons.forEach(function(button,i){var eventFn=self._closeEvents[i];_off(button,"click",eventFn)});return true};Taggle.prototype._fixInputWidth=function(){this._setMeasurements();this._setInputWidth()};Taggle.prototype._canAdd=function(e,text){if(!text){return false}var limit=this.settings.maxTags;if(limit!==null&&limit<=this.getTagValues().length){return false}if(this.settings.onBeforeTagAdd(e,text)===false){return false}if(!this.settings.allowDuplicates&&this._hasDupes(text)){return false}var sensitive=this.settings.preserveCase;var allowed=this.settings.allowedTags;if(allowed.length&&!this._tagIsInArray(text,allowed,sensitive)){return false}var disallowed=this.settings.disallowedTags;if(disallowed.length&&this._tagIsInArray(text,disallowed,sensitive)){return false}return true};Taggle.prototype._tagIsInArray=function(text,arr,caseSensitive){if(caseSensitive){return arr.indexOf(text)!==-1}var lowercased=[].slice.apply(arr).map(function(str){return str.toLowerCase()});return lowercased.indexOf(text)!==-1};Taggle.prototype._add=function(e,text,index){var self=this;var values=text||"";var delimiter=this.settings.delimiter||this.settings.delimeter;if(typeof text!=="string"){values=this.input.value;if(this.settings.trimTags){if(values[0]===delimiter){values=values.replace(delimiter,"")}values=_trim(values)}}values.split(delimiter).map(function(val){if(self.settings.trimTags){val=_trim(val)}return self._formatTag(val)}).forEach(function(val){if(!self._canAdd(e,val)){return}var currentTagLength=self.tag.values.length;var tagIndex=_clamp(index||currentTagLength,0,currentTagLength);var li=self._createTag(val,tagIndex);var lis=self.list.children;var lastLi=lis[tagIndex];self.list.insertBefore(li,lastLi);val=self.tag.values[tagIndex];self.settings.onTagAdd(e,val);self.input.value="";self._fixInputWidth();self._setFocusStateForContainer()})};Taggle.prototype._checkPrevOrNextTag=function(e){e=e||window.event;var taggles=this.container.querySelectorAll(".taggle");var prevTagIndex=_clamp(this._inputPosition-1,0,taggles.length-1);var nextTagIndex=_clamp(this._inputPosition,0,taggles.length-1);var index=prevTagIndex;if(e.keyCode===DELETE){index=nextTagIndex}var targetTaggle=taggles[index];var hotClass="taggle_hot";var isDeleteOrBackspace=[BACKSPACE,DELETE].indexOf(e.keyCode)!==-1;if(this.input.value===""&&isDeleteOrBackspace&&!this._backspacePressed){if(targetTaggle.classList.contains(hotClass)){this._backspacePressed=true;this._remove(targetTaggle,e);this._fixInputWidth();this._setFocusStateForContainer()}else{targetTaggle.classList.add(hotClass)}}else if(targetTaggle.classList.contains(hotClass)){targetTaggle.classList.remove(hotClass)}};Taggle.prototype._setInputWidth=function(){var width=this.sizer.getBoundingClientRect().width;var max=this.measurements.container.rect.width-this.measurements.container.padding;var size=parseInt(this.sizer.style.fontSize,10);var newWidth=Math.round(_clamp(width+size*1.5,10,max));this.input.style.width=newWidth+"px"};Taggle.prototype._hasDupes=function(text){var needle=this.tag.values.indexOf(text);var tagglelist=this.container.querySelector(".taggle_list");var dupes;if(this.settings.duplicateTagClass){dupes=tagglelist.querySelectorAll("."+this.settings.duplicateTagClass);for(var i=0,len=dupes.length;i<len;i++){dupes[i].classList.remove(this.settings.duplicateTagClass)}}if(needle>-1){if(this.settings.duplicateTagClass){tagglelist.childNodes[needle].classList.add(this.settings.duplicateTagClass)}return true}return false};Taggle.prototype._isConfirmKey=function(key){var confirmKey=false;if(this.settings.submitKeys.indexOf(key)>-1){confirmKey=true}return confirmKey};Taggle.prototype._setFocusStateForContainer=function(){this._fixInputWidth();if(!this.container.classList.contains(this.settings.containerFocusClass)){this.container.classList.add(this.settings.containerFocusClass)}this._hidePlaceholder()};Taggle.prototype._blurEvent=function(e){if(this.container.classList.contains(this.settings.containerFocusClass)){this.container.classList.remove(this.settings.containerFocusClass)}if(this.settings.saveOnBlur){e=e||window.event;this._setInputWidth();if(this.input.value!==""){this._confirmValidTagEvent(e);return}if(this.tag.values.length){this._checkPrevOrNextTag(e)}}else if(this.settings.clearOnBlur){this.input.value="";this._setInputWidth()}if(!this.tag.values.length&&!this.input.value){this._showPlaceholder()}};Taggle.prototype._keydownEvents=function(e){e=e||window.event;var key=e.keyCode;this.pasting=false;this._setInputWidth();if(key===86&&e.metaKey){this.pasting=true}if(this._isConfirmKey(key)&&this.input.value!==""){this._confirmValidTagEvent(e);return}if(this.tag.values.length){this._checkPrevOrNextTag(e)}};Taggle.prototype._keyupEvents=function(e){e=e||window.event;this._backspacePressed=false;if([ARROW_LEFT,ARROW_RIGHT].indexOf(e.keyCode)!==-1){this._moveInput(e.keyCode);return}_setText(this.sizer,this.input.value);if(!this.input.value){this._setInputWidth()}if(this.pasting&&this.input.value!==""){this._add(e);this.pasting=false}};Taggle.prototype._moveInput=function(direction){var currentIndex=this._inputPosition;switch(direction){case ARROW_LEFT:{var leftNewIndex=_clamp(this._inputPosition-1,0,this.tag.values.length);var leftIndexChanged=currentIndex!==leftNewIndex;this._inputPosition=leftNewIndex;if(leftIndexChanged){this.list.insertBefore(this.inputLi,this.list.childNodes[leftNewIndex]||null);this.input.focus()}break}case ARROW_RIGHT:{var rightNewIndex=_clamp(this._inputPosition+1,0,this.tag.values.length);var rightIndexChanged=currentIndex!==rightNewIndex;this._inputPosition=rightNewIndex;if(rightIndexChanged){this.list.insertBefore(this.inputLi,this.list.childNodes[rightNewIndex+1]||null);this.input.focus()}break}default:break}};Taggle.prototype._confirmValidTagEvent=function(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}this._add(e,null,this._inputPosition)};Taggle.prototype._createTag=function(text,index){var li=document.createElement("li");var close=document.createElement("button");var hidden=document.createElement("input");var span=document.createElement("span");text=this._formatTag(text);_setText(close,"×");close.className="close";close.setAttribute("type","button");var eventFn=this._remove.bind(this,close);_on(close,"click",eventFn);_setText(span,text);span.className="taggle_text";li.className="taggle "+this.settings.additionalTagClasses;hidden.type="hidden";hidden.value=text;hidden.name=this.settings.hiddenInputName;li.appendChild(span);li.appendChild(close);li.appendChild(hidden);var formatted=this.settings.tagFormatter(li);if(typeof formatted!=="undefined"){li=formatted}if(!(li instanceof HTMLElement)||!(li.localName==="li"||li.tagName==="LI")){throw new Error("tagFormatter must return an li element")}if(this.settings.attachTagId){this._id+=1;text={text:text,id:this._id}}this.tag.values.splice(index,0,text);this.tag.elements.splice(index,0,li);this._closeEvents.splice(index,0,eventFn);this._closeButtons.splice(index,0,close);this._inputPosition=_clamp(this._inputPosition+1,0,this.tag.values.length);return li};Taggle.prototype._showPlaceholder=function(){if(this.placeholder){this.placeholder.style.opacity=1;this.placeholder.setAttribute("aria-hidden","false")}};Taggle.prototype._hidePlaceholder=function(){if(this.placeholder){this.placeholder.style.opacity=0;this.placeholder.setAttribute("aria-hidden","true")}};Taggle.prototype._remove=function(li,e){var self=this;var text;var elem;var index;if(li.tagName.toLowerCase()!=="li"){li=li.parentNode}elem=li.tagName.toLowerCase()==="a"?li.parentNode:li;index=this.tag.elements.indexOf(elem);text=this.tag.values[index];function done(error){if(error){return}var eventFn=self._closeEvents[index];var button=self._closeButtons[index];_off(button,"click",eventFn);li.parentNode.removeChild(li);self.tag.elements.splice(index,1);self.tag.values.splice(index,1);self._closeEvents.splice(index,1);self._closeButtons.splice(index,1);self.settings.onTagRemove(e,text);if(index<self._inputPosition){self._inputPosition=_clamp(self._inputPosition-1,0,self.tag.values.length)}self._setFocusStateForContainer()}var ret=this.settings.onBeforeTagRemove(e,text,done);if(!ret){return}done()};Taggle.prototype._formatTag=function(text){return this.settings.preserveCase?text:text.toLowerCase()};Taggle.prototype._isIndexInRange=function(index){return index>=0&&index<=this.tag.values.length-1};Taggle.prototype.getTags=function(){return{elements:this.getTagElements(),values:this.getTagValues()}};Taggle.prototype.getTagElements=function(){return[].slice.apply(this.tag.elements)};Taggle.prototype.getTagValues=function(){return[].slice.apply(this.tag.values)};Taggle.prototype.getInput=function(){return this.input};Taggle.prototype.getContainer=function(){return this.container};Taggle.prototype.add=function(text,index){var isArr=_isArray(text);if(isArr){var startingIndex=index;for(var i=0,len=text.length;i<len;i++){if(typeof text[i]==="string"){this._add(null,text[i],startingIndex);if(!isNaN(startingIndex)){startingIndex+=1}}}}else{this._add(null,text,index)}return this};Taggle.prototype.edit=function(text,index){if(typeof text!=="string"){throw new Error("First edit argument must be of type string")}if(typeof index!=="number"){throw new Error("Second edit argument must be a number")}if(!this._isIndexInRange(index)){throw new Error("Edit index should be between 0 and "+this.tag.values.length-1)}var textValue=this.tag.values[index];if(typeof textValue==="string"){this.tag.values[index]=text}else{this.tag.values[index].text=text}_setText(this.tag.elements[index],text);return this};Taggle.prototype.move=function(currentIndex,destinationIndex){if(typeof currentIndex!=="number"||typeof destinationIndex!=="number"){throw new Error("Both arguments must be numbers")}if(!this._isIndexInRange(currentIndex)){throw new Error("First index should be between 0 and "+this.tag.values.length-1)}if(!this._isIndexInRange(destinationIndex)){throw new Error("Second index should be between 0 and "+this.tag.values.length-1)}if(currentIndex===destinationIndex){return this}var value=this.tag.values[currentIndex];var element=this.tag.elements[currentIndex];var lastElement=this.tag.elements[destinationIndex];var eventFn=this._closeEvents[currentIndex];var closeButton=this._closeButtons[currentIndex];this.tag.values.splice(currentIndex,1);this.tag.elements.splice(currentIndex,1);this._closeEvents.splice(currentIndex,1);this._closeButtons.splice(currentIndex,1);this.tag.values.splice(destinationIndex,0,value);this.tag.elements.splice(destinationIndex,0,element);this._closeEvents.splice(currentIndex,0,eventFn);this._closeButtons.splice(currentIndex,0,closeButton);this.list.insertBefore(element,lastElement.nextSibling);return this};Taggle.prototype.remove=function(text,all){var len=this.tag.values.length-1;var found=false;while(len>-1){var tagText=this.tag.values[len];if(this.settings.attachTagId){tagText=tagText.text}if(tagText===text){found=true;this._remove(this.tag.elements[len])}if(found&&!all){break}len--}return this};Taggle.prototype.removeAll=function(){for(var i=this.tag.values.length-1;i>=0;i--){this._remove(this.tag.elements[i])}this._showPlaceholder();return this};Taggle.prototype.setOptions=function(options){this.settings=_extend({},this.settings,options||{});return this};Taggle.prototype.enable=function(){var buttons=[].slice.call(this.container.querySelectorAll("button"));var inputs=[].slice.call(this.container.querySelectorAll("input"));buttons.concat(inputs).forEach(function(el){el.removeAttribute("disabled")});return this};Taggle.prototype.disable=function(){var buttons=[].slice.call(this.container.querySelectorAll("button"));var inputs=[].slice.call(this.container.querySelectorAll("input"));buttons.concat(inputs).forEach(function(el){el.setAttribute("disabled","")});return this};Taggle.prototype.setData=function(data){this.data=data;return this};Taggle.prototype.getData=function(){return this.data};Taggle.prototype.attachEvents=function(){var self=this;var attached=this._attachEvents();if(attached){this._closeButtons.forEach(function(button,i){var eventFn=self._closeEvents[i];_on(button,"click",eventFn)})}return this};Taggle.prototype.removeEvents=function(){this._detachEvents();return this};return Taggle});